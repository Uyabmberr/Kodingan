"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; } var _class; var _class2;var R=({protect:f})=>{var S=3;function w(a){return new Promise((t,r)=>{if(document.querySelector(`script[src="${a}"]`)){t();return}let s=document.createElement("script");s.src=a,s.async=!0,s.onload=()=>t(),s.onerror=o=>{console.error("Error loading script",o),r(o)},document.head.appendChild(s)})}var H="/149e9513-01fa-4fb0-aad4-566afd725d1b/2d206a39-8ed7-437e-a3be-862e0f06eea3/a-4-a/c.js",P= (_class =class m{#e;#t;#n=0;constructor(){;_class.prototype.__init.call(this);let{promise:e,resolve:t}=m.#o();this.#e=e,this.#t=t,this.#r(),window.addEventListener("online",this.#s),window.addEventListener("visibilitychange",this.#s)}__init() {this.getChallenge=async()=>(await this.#i(),await this.#e.then(t=>typeof t=="function"?t():t))}#s=()=>{if(document.hidden)return;let{promise:e,resolve:t}=m.#o();this.#e=e,this.#t=t,window.V_C=[],window.V_C.push=t;let r=document.querySelector('script[src*="c.js"]');r&&r.remove(),this.#n+=1};#r=()=>{if(window.V_C){let e=window.V_C.pop();e&&this.#t(e)}else window.V_C=[],window.V_C.push=this.#t};#i=()=>{let e=new URL(H,window.location.origin);return e.searchParams.set("i",String(this.#n)),e.searchParams.set("v",String(S)),e.searchParams.set("h",window.location.host),w(e.pathname+e.search)};#a=()=>{window.V_C=void 0};static#o(){let e,t;return{promise:new Promise((s,o)=>{e=s,t=o}),resolve:e,reject:t}}}, _class),q="/149e9513-01fa-4fb0-aad4-566afd725d1b/2d206a39-8ed7-437e-a3be-862e0f06eea3",x= (_class2 =class L{#e=!1;#t;constructor(e){;_class2.prototype.__init2.call(this);this.#t=e}get loaded(){return this.#e}__init2() {this.load=async()=>{this.#e||await this.#s()}}#n=()=>{if(typeof globalThis.window>"u")throw new Error("KPSDK is not available in the server");if(!window.KPSDK)throw new Error("KPSDK is not loaded");let e=this.#t.map(t=>{let r=L.#r(t.path);return{domain:r.host,path:r.pathname,method:t.method}});try{window.KPSDK.configure(e)}catch(t){console.error("Error configuring KPSDK...",t)}};#s=async()=>{let e=`${q}/p.js`,t=this;return new Promise((r,s)=>{let o=()=>{document.removeEventListener("kpsdk-load",o),this.#n()},c=()=>{document.removeEventListener("kpsdk-ready",c),t.#e=!0,r()};document.addEventListener("kpsdk-load",o,{once:!0}),document.addEventListener("kpsdk-ready",c,{once:!0}),w(e).catch(d=>{document.removeEventListener("kpsdk-load",o),document.removeEventListener("kpsdk-ready",c),s(d)})})};static#r(e){let t;try{t=new URL(e)}catch (e2){t=new URL(e,location.origin)}return t}}, _class2),v=a=>{let e=a.replace(/[.?+^$[\]\\(){}|-]/g,"\\$&").split("*").join(".*");return new RegExp(`^${e}$`)},y=({path:a,pattern:e})=>a.search(e)!==-1;function C(a,e,t){let r=window.fetch;window.fetch=async(s,o)=>{let c=new URL(s instanceof Request?s.url:s,location.href),d=c.origin===location.origin,h=_nullishCoalesce(_optionalChain([o, 'optionalAccess', _2 => _2.method]), () => ((s instanceof Request?s.method:"GET"))),u=t.find(p=>{let g=y({path:c.pathname,pattern:v(p.path)}),_=p.method.toLowerCase()===h.toLowerCase()||p.method==="*";return g&&_});if(u==null||!d)return r(s,o);let l=await a.getChallenge(),n=new Headers(_optionalChain([o, 'optionalAccess', _3 => _3.headers])||(s instanceof Request?s.headers:void 0));n.set("x-is-human",JSON.stringify(l)),n.set("x-path",c.pathname),n.set("x-method",h);let i={...o,headers:n};return e.loaded||l.b!==0?r(s,i):l.d===1||_optionalChain([u, 'optionalAccess', _4 => _4.advancedOptions, 'optionalAccess', _5 => _5.checkLevel])==="deepAnalysis"?(await e.load(),window.fetch(s,i)):r(s,i)}}async function E(a,e,t){let r=XMLHttpRequest.prototype.open,s=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(o,c,d,h,u){return this._requestUrl=c.toString(),this._requestMethod=o,r.call(this,o,c,_nullishCoalesce(d, () => (!0)),h,u)},XMLHttpRequest.prototype.send=async function(o){let c=this._requestUrl;if(!c)return s.call(this,o);if(this._isReexecution)return s.call(this,o);let d=new URL(c,location.href),h=_nullishCoalesce(this._requestMethod, () => ("GET")),u=t.find(i=>{let p=y({path:d.pathname,pattern:v(i.path)}),g=i.method===h||i.method==="*";return p&&g});if(!u)return s.call(this,o);let l=await a.getChallenge();if(this.setRequestHeader("x-is-human",JSON.stringify(l)),this.setRequestHeader("x-path",d.pathname),this.setRequestHeader("x-method",h),l.b!==0)return s.call(this,o);if(e.loaded)return s.call(this,o);if((l.d===1||_optionalChain([u, 'optionalAccess', _6 => _6.advancedOptions, 'optionalAccess', _7 => _7.checkLevel])==="deepAnalysis")&&await e.load(),!e.loaded)return s.call(this,o);this.setRequestHeader("x-is-human",JSON.stringify(l)),this.setRequestHeader("x-path",d.pathname),this.setRequestHeader("x-method",h);let n=new XMLHttpRequest;return n._isReexecution=!0,n.open(h,c,!0),n.setRequestHeader("x-is-human",JSON.stringify(l)),n.setRequestHeader("x-path",d.pathname),n.setRequestHeader("x-method",h),this.timeout&&(n.timeout=this.timeout),this.responseType&&(n.responseType=this.responseType),this.withCredentials&&(n.withCredentials=this.withCredentials),n.onreadystatechange=()=>{Object.defineProperty(this,"readyState",{value:n.readyState,writable:!0,configurable:!0}),n.readyState===XMLHttpRequest.DONE&&(Object.defineProperty(this,"status",{value:n.status,writable:!0,configurable:!0}),Object.defineProperty(this,"statusText",{value:n.statusText,writable:!0,configurable:!0}),Object.defineProperty(this,"response",{value:n.response,writable:!0,configurable:!0}),Object.defineProperty(this,"responseText",{value:n.responseText,writable:!0,configurable:!0}),Object.defineProperty(this,"responseXML",{value:n.responseXML,writable:!0,configurable:!0}),this.getAllResponseHeaders=()=>n.getAllResponseHeaders(),this.getResponseHeader=i=>n.getResponseHeader(i)),this.onreadystatechange&&this.onreadystatechange.call(this,new Event("readystatechange"))},n.onload=i=>{this.onload&&this.onload.call(this,i)},n.onerror=i=>{this.onerror&&this.onerror.call(this,i)},n.onabort=i=>{this.onabort&&this.onabort.call(this,i)},n.ontimeout=i=>{this.ontimeout&&this.ontimeout.call(this,i)},n.onloadstart=i=>{this.onloadstart&&this.onloadstart.call(this,i)},n.onloadend=i=>{this.onloadend&&this.onloadend.call(this,i)},n.onprogress=i=>{this.onprogress&&this.onprogress.call(this,i)},n.send(o)}}function M({protect:a=[]}){for(let r of a)if(_optionalChain([r, 'access', _8 => _8.advancedOptions, 'optionalAccess', _9 => _9.checkLevel])!==void 0&&r.advancedOptions.checkLevel!=="deepAnalysis"&&r.advancedOptions.checkLevel!=="basic")throw new Error(`Invalid checkLevel "${r.advancedOptions.checkLevel}" for route "${r.path}". Must be one of: deepAnalysis, basic`);let e=new P,t=new x(a);E(e,t,a).catch(r=>{console.error("Error patching XMLHttpRequest:",r)}),C(e,t,a)}M({protect:f})};var _jsxruntime = require('react/jsx-runtime');var K=({protect:f})=>_jsxruntime.jsx.call(void 0, _jsxruntime.Fragment,{children:_jsxruntime.jsx.call(void 0, "script",{dangerouslySetInnerHTML:{__html:`(${R.toString()})({ protect: ${JSON.stringify(f)} });`}})});exports.BotIdClient = K;
