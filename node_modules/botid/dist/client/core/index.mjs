function m(i){return new Promise((t,s)=>{if(document.querySelector(`script[src="${i}"]`)){t();return}let r=document.createElement("script");r.src=i,r.async=!0,r.onload=()=>t(),r.onerror=o=>{console.error("Error loading script",o),s(o)},document.head.appendChild(r)})}var P="/149e9513-01fa-4fb0-aad4-566afd725d1b/2d206a39-8ed7-437e-a3be-862e0f06eea3/a-4-a/c.js",f=class i{#e;#t;#n=0;constructor(){let{promise:e,resolve:t}=i.#o();this.#e=e,this.#t=t,this.#s(),window.addEventListener("online",this.#r),window.addEventListener("visibilitychange",this.#r)}getChallenge=async()=>(await this.#a(),await this.#e.then(t=>typeof t=="function"?t():t));#r=()=>{if(document.hidden)return;let{promise:e,resolve:t}=i.#o();this.#e=e,this.#t=t,window.V_C=[],window.V_C.push=t;let s=document.querySelector('script[src*="c.js"]');s&&s.remove(),this.#n+=1};#s=()=>{if(window.V_C){let e=window.V_C.pop();e&&this.#t(e)}else window.V_C=[],window.V_C.push=this.#t};#a=()=>{let e=new URL(P,window.location.origin);return e.searchParams.set("i",String(this.#n)),e.searchParams.set("v",String(3)),e.searchParams.set("h",window.location.host),m(e.pathname+e.search)};#i=()=>{window.V_C=void 0};static#o(){let e,t;return{promise:new Promise((r,o)=>{e=r,t=o}),resolve:e,reject:t}}};var b="/149e9513-01fa-4fb0-aad4-566afd725d1b/2d206a39-8ed7-437e-a3be-862e0f06eea3",g=class i{#e=!1;#t;constructor(e){this.#t=e}get loaded(){return this.#e}load=async()=>{this.#e||await this.#r()};#n=()=>{if(typeof globalThis.window>"u")throw new Error("KPSDK is not available in the server");if(!window.KPSDK)throw new Error("KPSDK is not loaded");let e=this.#t.map(t=>{let s=i.#s(t.path);return{domain:s.host,path:s.pathname,method:t.method}});try{window.KPSDK.configure(e)}catch(t){console.error("Error configuring KPSDK...",t)}};#r=async()=>{let e=`${b}/p.js`,t=this;return new Promise((s,r)=>{let o=()=>{document.removeEventListener("kpsdk-load",o),this.#n()},c=()=>{document.removeEventListener("kpsdk-ready",c),t.#e=!0,s()};document.addEventListener("kpsdk-load",o,{once:!0}),document.addEventListener("kpsdk-ready",c,{once:!0}),m(e).catch(l=>{document.removeEventListener("kpsdk-load",o),document.removeEventListener("kpsdk-ready",c),r(l)})})};static#s(e){let t;try{t=new URL(e)}catch{t=new URL(e,location.origin)}return t}};var w=i=>{let e=i.replace(/[.?+^$[\]\\(){}|-]/g,"\\$&").split("*").join(".*");return new RegExp(`^${e}$`)},R=({path:i,pattern:e})=>i.search(e)!==-1;function v(i,e,t){let s=window.fetch;window.fetch=async(r,o)=>{let c=new URL(r instanceof Request?r.url:r,location.href),l=c.origin===location.origin,d=o?.method??(r instanceof Request?r.method:"GET"),p=t.find(u=>{let y=R({path:c.pathname,pattern:w(u.path)}),L=u.method.toLowerCase()===d.toLowerCase()||u.method==="*";return y&&L});if(p==null||!l)return s(r,o);let h=await i.getChallenge(),n=new Headers(o?.headers||(r instanceof Request?r.headers:void 0));n.set("x-is-human",JSON.stringify(h)),n.set("x-path",c.pathname),n.set("x-method",d);let a={...o,headers:n};return e.loaded||h.b!==0?s(r,a):h.d===1||p?.advancedOptions?.checkLevel==="deepAnalysis"?(await e.load(),window.fetch(r,a)):s(r,a)}}async function x(i,e,t){let s=XMLHttpRequest.prototype.open,r=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(o,c,l,d,p){return this._requestUrl=c.toString(),this._requestMethod=o,s.call(this,o,c,l??!0,d,p)},XMLHttpRequest.prototype.send=async function(o){let c=this._requestUrl;if(!c)return r.call(this,o);if(this._isReexecution)return r.call(this,o);let l=new URL(c,location.href),d=this._requestMethod??"GET",p=t.find(a=>{let u=R({path:l.pathname,pattern:w(a.path)}),y=a.method===d||a.method==="*";return u&&y});if(!p)return r.call(this,o);let h=await i.getChallenge();if(this.setRequestHeader("x-is-human",JSON.stringify(h)),this.setRequestHeader("x-path",l.pathname),this.setRequestHeader("x-method",d),h.b!==0)return r.call(this,o);if(e.loaded)return r.call(this,o);if((h.d===1||p?.advancedOptions?.checkLevel==="deepAnalysis")&&await e.load(),!e.loaded)return r.call(this,o);this.setRequestHeader("x-is-human",JSON.stringify(h)),this.setRequestHeader("x-path",l.pathname),this.setRequestHeader("x-method",d);let n=new XMLHttpRequest;return n._isReexecution=!0,n.open(d,c,!0),n.setRequestHeader("x-is-human",JSON.stringify(h)),n.setRequestHeader("x-path",l.pathname),n.setRequestHeader("x-method",d),this.timeout&&(n.timeout=this.timeout),this.responseType&&(n.responseType=this.responseType),this.withCredentials&&(n.withCredentials=this.withCredentials),n.onreadystatechange=()=>{Object.defineProperty(this,"readyState",{value:n.readyState,writable:!0,configurable:!0}),n.readyState===XMLHttpRequest.DONE&&(Object.defineProperty(this,"status",{value:n.status,writable:!0,configurable:!0}),Object.defineProperty(this,"statusText",{value:n.statusText,writable:!0,configurable:!0}),Object.defineProperty(this,"response",{value:n.response,writable:!0,configurable:!0}),Object.defineProperty(this,"responseText",{value:n.responseText,writable:!0,configurable:!0}),Object.defineProperty(this,"responseXML",{value:n.responseXML,writable:!0,configurable:!0}),this.getAllResponseHeaders=()=>n.getAllResponseHeaders(),this.getResponseHeader=a=>n.getResponseHeader(a)),this.onreadystatechange&&this.onreadystatechange.call(this,new Event("readystatechange"))},n.onload=a=>{this.onload&&this.onload.call(this,a)},n.onerror=a=>{this.onerror&&this.onerror.call(this,a)},n.onabort=a=>{this.onabort&&this.onabort.call(this,a)},n.ontimeout=a=>{this.ontimeout&&this.ontimeout.call(this,a)},n.onloadstart=a=>{this.onloadstart&&this.onloadstart.call(this,a)},n.onloadend=a=>{this.onloadend&&this.onloadend.call(this,a)},n.onprogress=a=>{this.onprogress&&this.onprogress.call(this,a)},n.send(o)}}function q({protect:i=[]}){for(let s of i)if(s.advancedOptions?.checkLevel!==void 0&&s.advancedOptions.checkLevel!=="deepAnalysis"&&s.advancedOptions.checkLevel!=="basic")throw new Error(`Invalid checkLevel "${s.advancedOptions.checkLevel}" for route "${s.path}". Must be one of: deepAnalysis, basic`);let e=new f,t=new g(i);x(e,t,i).catch(s=>{console.error("Error patching XMLHttpRequest:",s)}),v(e,t,i)}var H=i=>i;export{q as initBotId,H as validateProtectedRoutes};
